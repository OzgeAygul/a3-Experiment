<!DOCTYPE html>
<meta charset="utf-8">

<!-- Load d3.js -->
<script src="https://d3js.org/d3.v6.js"></script>

<!-- Create a div where the graph will take place -->
<div id="my_dataviz"></div>
<script>
  // set the dimensions and margins of the graph
  const width = 450,
      height = 450,
      margin = 40;

  // The radius of the pieplot is half the width or half the height (smallest one). I subtract a bit of margin.
  const radius = Math.min(width, height) / 2 - margin;

  // append the svg object to the div called 'my_dataviz'
  const svg = d3.select("#my_dataviz")
    .append("svg")
      .attr("width", width)
      .attr("height", height)
    .append("g")
      .attr("transform", `translate(${width / 2}, ${height / 2})`);

  const data = {a: 6, b: 8, c: 10, d: 12, e: 15, f: 21, g: 28};

  // set the color scale
  const color = d3.scaleOrdinal()
    .range(["#ffffff", "#ffffff", "#ffffff", "#ffffff", "#ffffff", "#ffffff", "#ffffff"]);

  // Compute the position of each group on the pie:
  const pie = d3.pie()
    .value(function(d) { return d[1]; });
  const data_ready = pie(Object.entries(data));

   // Define the arc generator
  const arcGenerator = d3.arc()
    .innerRadius(0)
    .outerRadius(radius);

  // Build the pie chart
  svg
    .selectAll('path')
    .data(data_ready)
    .enter() // Change join to enter for consistency with the D3 v5 and earlier
    .append('path')
    .attr('d', arcGenerator) // Use the arc generator function
    .attr('fill', function(d){ return(color(d.data.key)); }) // Use d.data.key to access the key of the entry
    .attr("stroke", "black")
    .style("stroke-width", "2px")
    .style("opacity", 0.7);

  // Choose two random slice indices for placing the dots
  const randomSliceIndices = [];
  while (randomSliceIndices.length < 2) {
    let r = Math.floor(Math.random() * data_ready.length);
    if (randomSliceIndices.indexOf(r) === -1) randomSliceIndices.push(r);
  }

  // Place a dot in the centroid of two random slices
  randomSliceIndices.forEach((sliceIndex) => {
    const slice = data_ready[sliceIndex];
    const centroid = arcGenerator.centroid(slice); // Make sure to use arcGenerator

    svg
      .append('circle')
      .attr('cx', centroid[0])
      .attr('cy', centroid[1])
      .attr('r', 5) // Radius of the dot
      .attr('fill', 'black');
  });
</script>
